---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Get all blog posts
const posts = await getCollection('blog');
// Sort by date (newest first)
posts.sort((a, b) => {
  const dateA = new Date(a.data.date || 0);
  const dateB = new Date(b.data.date || 0);
  return dateB.getTime() - dateA.getTime();
});
---

<Layout title="ModernBlog">
  <main>
    <h1>ModernBlog</h1>
    <p>A modern, automated blog publishing pipeline.</p>
    
    <section>
      <h2>Recent Posts</h2>
      <ul>
        {posts.map((post) => (
          <li>
            <a href={`/blog/${post.slug}`}>
              {post.data.title || post.slug}
            </a>
            {post.data.date && (
              <span> - {new Date(post.data.date).toLocaleDateString()}</span>
            )}
          </li>
        ))}
      </ul>
    </section>
  </main>
</Layout>

